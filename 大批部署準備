範本 VM 最佳化與通用化配置
🛠️ 第一部分：標準化安裝與設定 (要保留的)

這是您希望所有新部署的 VM 都具備的基礎服務：

    安裝 SSH 伺服器 (Openssh-server): 確保所有未來的 VM 都可以遠端連線。
    Bash

sudo apt update
sudo apt install openssh-server

安裝 NFS 客戶端/伺服器工具: 確保所有 VM 都具備連線和共享檔案的能力。
Bash

sudo apt install nfs-common nfs-kernel-server

設置通用使用者帳戶： 確保您常用的管理帳戶 (ubn) 已經建立，並且 sudo 權限正常。

限制日誌大小（推薦）： 避免 VM 啟動後日誌無限制增長佔滿硬碟空間。
Bash

    sudo nano /etc/systemd/journald.conf
    # 在 [Journal] 區塊新增或修改為：
    # SystemMaxUse=500M

🧹 第二部分：清理與通用化 (要移除的)

在將 VM 關機並製作成範本之前，移除所有唯一的識別符是確保所有複製出來的 VM 能夠順利運行的關鍵：
1. 移除 SSH Host Keys (最重要！)

SSH Host Keys 是每台機器的唯一識別符。複製範本時，如果新舊 VM 擁有相同的 Key，會導致 SSH 連線時出現安全警告或衝突。
Bash

# 移除所有 host keys
sudo rm /etc/ssh/ssh_host_*

    結果： 新 VM 第一次啟動時，會自動重新生成一套全新的 Host Key。

2. 清理網路和 MAC 地址記錄

舊的網路配置可能會導致複製出來的 VM 抓不到新的 IP 或網卡：
Bash

# 清理 udev 規則中的 MAC 地址記錄 (舊 Ubuntu/CentOS 常見)
sudo rm -f /etc/udev/rules.d/70-persistent-net.rules

# 清理 netplan/network-manager 狀態 (新 Ubuntu)
sudo rm -f /etc/netplan/*
sudo rm -f /var/lib/NetworkManager/dhclient-*

3. 清理系統日誌和快取

減少範本的大小並確保新 VM 從乾淨的日誌開始：
Bash

# 清理系統日誌
sudo journalctl --vacuum-time=1d  # 只保留過去一天的日誌
sudo journalctl --vacuum-size=50M # 限制日誌總大小

# 清理 apt 快取 (下載的安裝包)
sudo apt clean

# 清理 bash 歷史記錄
history -c && rm ~/.bash_history

4. 清理 SSH 金鑰授權 (可選)

如果您不希望範本中包含任何舊的 SSH 登入金鑰配置：
Bash

# 移除 ubn 用戶的授權金鑰
rm -f /home/ubn/.ssh/authorized_keys

    結果： 範本複製出來後，您可以乾淨地重新部署 SSH 金鑰（如我們在前面討論的）。

🔌 最後一步：關機

在執行完所有清理和安裝工作後，請正常關機，然後再將此 VM 轉換為 ESXi 範本：
Bash

sudo shutdown now
